body { background: #191919; color: #e6e6e6; }
html { margin:0; padding:0; height:100%; font-family:sans-serif; }
#main { display:flex; height:calc(100vh - 100px); }
#controls { padding: 16px; background: #222; border-bottom: 1px solid #333; }

:root {
  --grid-brightness: 1;
  --image-brightness: 1;
}
#drawflow {
  position: relative;
  flex: 3;
  height: 700px;
  background-color: #000;
  overflow: hidden;
  z-index: 1;
}

#drawflow-bottomline {
  position: absolute;
  left: 0; right: 0;
  height: 1px;
  background: #b9f8b9;
  pointer-events: none;
  z-index: 2;
}
#drawflow {
  position: relative; /* Add if not present! */
}

#editor { flex: 1; min-width: 340px; padding: 18px 16px 16px 16px; background: #181818; }
#nodeEditor label { margin-top: 6px; margin-right: 6px; display:inline-block; }
#nodeEditor input, #nodeEditor select { margin-bottom: 7px; margin-right:8px;}
#wsLogBox {
  resize: vertical;
  min-height: 50px;
  max-height: 300px;
  height: 120px;
}
.log-info { color: #2d862d; }
.log-error { color: #c0392b; }

select { padding:6px; font-size:14px; border-radius:4px; border:1px solid #ccc; }

button {
  background: #169c00; color: #f3f3f3;
  border: none; padding: 6px 14px; border-radius: 7px;
  margin-right: 4px; margin-bottom: 8px; cursor:pointer;
}
button:active { background: #2d862d; color: white; }

button:hover { background: #02c258; }
  .logic-node {
    min-width: 65px !important;
    max-width: 65px !important;
    width: 65px !important;
    min-height: 32px !important;
    max-height: 32px !important;
    height: 32px !important;
    font-size: 13px !important;
    padding: 2px 0px !important;
    text-align: center !important;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto !important;
  }
  .current-value {
    font-size: 12px;
    font-weight: 500;
    margin-top: 2px;
    padding: 2px 8px;
    border-radius: 6px;
    display: inline-block;
    background: transparent !important;
  }
  .main-path.highlighted {
    stroke: limegreen !important;
    stroke-width: 4px !important;
    filter: drop-shadow(0 0 6px #0f0) !important;
  }
  .drawflow-node.executed {
    border: 3px solid #ffe54e !important;
    box-shadow: 0 0 18px #ffe54e !important;
  }
  #sendFlow.need-save {
    background: #e6462d !important;   /* red */
    color: #fff !important;
    border: 2px solid #900 !important;
    font-weight: bold;
    box-shadow: 0 0 8px #e6462d77;
  }
  .cv-on    { color: #0c0; }
  .cv-off   { color: #e34c4c; }
  .cv-num   { color: #3af; }
  .cv-other { color: #eec150; }
  .drawflow-node {
    border-radius: 18px !important;
    box-shadow: 0 2px 14px 0 #00000022;
    overflow: hidden;
    border: 1.5px solid #29475e;
    background: #232a2d;
  }
  .drawflow-node .drawflow-content {
    border-radius: 0 0 16px 16px;
    padding: 9px 8px;
  }
  
  #exportVarsBtn.need-export {
    background: #e6462d !important;   /* red */
    color: #fff !important;
    border: 2px solid #900 !important;
    font-weight: bold;
    box-shadow: 0 0 8px #e6462d77;
  }

.drawflow-node .outputs .output { width: 14px; height: 14px; }
.drawflow-node .outputs .output[data-name="false"] { background: #e67e22; }
.drawflow-node .outputs .output[data-name="true"] { background: #27ae60; }

.drawflow .drawflow-node {
  background: #5d2ef8 !important;
  border: 2.2px solid #0cb56d !important;
  color: #000 !important;
}

.drawflow .drawflow-node.selected {
  border: 3px solid #02f84c !important;
  box-shadow: 0 0 8px 2px #02f84c80 !important;
}

.drawflow-node.eventTrigger {
  background: #fb0101 !important;
  border: 2.2px solid #0cb56d !important;
  color: #000 !important;
}

.drawflow-node.condition {
  background: #fc9331 !important;
  border: 2.2px solid #0cb56d !important;
  color: #000 !important;
}

.drawflow-node.device {
  background: #68f389 !important;
  border: 2.2px solid #0cb56d !important;
  color: #000 !important;
}

.drawflow-node.setVariable {
  background: #f7026c !important;
  border: 2.2px solid #0cb56d !important;
  color: #000 !important;
}

.drawflow-node.notification {
  background: #01a8fb !important;
  border: 2.2px solid #0cb56d !important;
  color: #000 !important;
}

.drawflow-node.comment {
  background: #faf777 !important;
  border: 2.2px solid #0cb56d !important;
  color: #000 !important;
  min-width: 300px !important;
  border-radius: 0 !important;
  transform: rotate(-1deg);
}

.drawflow-node.and,
.drawflow-node.or,
.drawflow-node.not {
  background: #ab02f9 !important;
  border: 2.2px solid #0cb56d !important;
  color: #000 !important;
}

.drawflow-node.schedule {
  background: #fb0101 !important;
  border: 2.2px solid #0cb56d !important;
  color: #000 !important;
}

.drawflow-node.selected-multi {
  border: 2.5px solid #308bfa !important;
  box-shadow: 0 0 0 3px #308bfa33, 0 3px 20px #000a !important;
  z-index: 11 !important;
}

#df-ctx-menu {
  animation: fadeinCtx .16s;
  box-shadow: 0 8px 32px #000b !important;
}
#df-ctx-menu div {
  border-radius: 7px;
}
#df-ctx-menu div:active {
  filter: brightness(1.12);
  background: #3e62ed !important;
}
@keyframes fadeinCtx {
  from { opacity: 0; transform: scale(.97);}
  to { opacity: 1; transform: scale(1);}
}

.drawflow-node.replay-path {
  box-shadow: 0 0 0 4px #ffe46b, 0 2px 10px #000b !important;
  border-color: #ffe46b !important;
  /* You can add any effect you want here! */
}

.drawflow-node.flow-path {
  box-shadow: 0 0 0 4px #f0e130, 0 2px 10px #000b !important;
  border-color: #ffe46b !important;
}

#drawflow-bg-image {
  position: absolute;
  top: 0; left: 0; width: 100%; height: 100%;
  object-fit: cover;
  z-index: 0;
  pointer-events: none;
  opacity: var(--image-brightness, 1);
  display: none;
  transition: opacity 0.2s;
}
#drawflow.image-bg #drawflow-bg-image {
  display: block;
}
#drawflow.grid-bg #drawflow-bg-image {
  display: none;
}
#drawflow::before {
  content: "";
  pointer-events: none;
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  width: 100%; height: 100%;
  z-index: 1;
  opacity: var(--grid-brightness, 1);
  background-image:
    linear-gradient(to right, #b9f8b9 1px, transparent 1px),
    linear-gradient(to bottom, #b9f8b9 1px, transparent 1px);
  background-size: 25px 25px;
  background-position: 0 0;
  transition: opacity 0.2s;
}
#drawflow.image-bg::before {
  display: none !important; /* Hide grid if image is on */
}

/* --- Ensure Drawflow input/output dots show up --- */
.drawflow .drawflow-node .inputs,
.drawflow .drawflow-node .outputs {
  width: 20px !important;
  min-width: 20px !important;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  z-index: 3;
}

.drawflow .drawflow-node .input,
.drawflow .drawflow-node .output {
  width: 16px !important;
  height: 16px !important;
  border-radius: 50%;
  border: 2px solid #000 !important;
  margin: 10px 0 10px 0 !important; /* was 6 6 0 */
  cursor: crosshair;
  box-shadow: 0 1px 4px #0005;
  display: block;
  background: #fc9d2e !important;  /* orange for output */
}
.drawflow .drawflow-node .input {
  background: #90cdf4 !important;   /* blue for input */
  left: -23px !important;    /* was -14px */
  position: relative;
}

.drawflow .drawflow-node .output {
  background: #fc9d2e !important;  /* orange for output */
  right: -23px !important;    /* was -14px */
  position: relative;
}

/* TOP output: If multiple outputs, first child = green */
.drawflow .drawflow-node .outputs .output:first-child {
  background: #27ae60 !important; /* green */
}

/* BOTTOM output: If multiple outputs, last child = red */
.drawflow .drawflow-node .outputs .output:last-child {
  background: #e6462d !important; /* red */
}

/* Only one output: both first and last, so override to green! */
.drawflow .drawflow-node .outputs .output:first-child:last-child {
  background: #27ae60 !important; /* green */
}
